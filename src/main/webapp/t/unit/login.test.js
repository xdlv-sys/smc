describe("User login ", function() {

    var taxScope, taxCtrl, loginScope, loginCtrl;
    var httpBackend;
    var userState;
    beforeEach(module('xdApp'));

    beforeEach(function() {
        inject(function($rootScope,$state, $controller, _$httpBackend_,configuration) {
            httpBackend = _$httpBackend_;

            spyOn($state, 'go').and.callFake(function(state, params) {
               userState = state; 
            });

            taxScope = $rootScope.$new();
            taxCtrl = $controller('taxController',{$scope : taxScope});

            loginScope = taxScope.$new();
            loginCtrl = $controller('LoginCtrl', { '$scope': loginScope });
            configuration.init();
        });
    });

    it("use name and password", function() {
        httpBackend.when('GET',/.*html$/).respond();
        httpBackend.when('POST','../user/userLogin.cmd').respond({"data":{"id":-10,"name":"a","password":"0cc175b9c0f1b6a831c399e269772661","birthday":null,"sex":0,"entryTime":null,"mobile":null,"phone":null,"idCard":null,"mail":"a@a.com","dept":{"id":1,"name":"事业部","parent":0,"roles":[]},"roles":[{"id":-2,"name":"管理员","mods":[{"id":1,"name":"系统配置","url":null,"routerId":null,"addition":"fa fa-user-secret","parentId":0},{"id":2,"name":"用户管理","url":null,"routerId":"user","addition":"fa fa-user","parentId":1},{"id":3,"name":"动态参数","url":null,"routerId":"conf","addition":"fa fa-pencil","parentId":1},{"id":4,"name":"新增用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":5,"name":"查看用户","url":"/user/obtainUsers","routerId":null,"addition":null,"parentId":2},{"id":6,"name":"删除用户","url":"/user/deleteUser","routerId":null,"addition":null,"parentId":2},{"id":7,"name":"修改用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":8,"name":"新增角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":9,"name":"查看角色","url":"/role/obtainRoles","routerId":null,"addition":null,"parentId":2},{"id":10,"name":"删除角色","url":"/role/deleteRole","routerId":null,"addition":null,"parentId":2},{"id":11,"name":"修改角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":12,"name":"查看部门","url":"/dept/obtainDepts","routerId":null,"addition":null,"parentId":2},{"id":13,"name":"商品管理","url":null,"routerId":null,"addition":"fa fa-truck","parentId":0},{"id":14,"name":"商品导入及审核","url":null,"routerId":"product","addition":"fa fa-truck","parentId":13},{"id":16,"name":"新增商品","url":"/product/saveProduct","routerId":null,"addition":null,"parentId":14},{"id":17,"name":"查看商品","url":"/product/obtainProducts","routerId":null,"addition":null,"parentId":14},{"id":18,"name":"删除商品","url":"/product/deleteProduct","routerId":null,"addition":null,"parentId":14},{"id":19,"name":"审批商品","url":"/product/approveProduct","routerId":null,"addition":null,"parentId":14},{"id":20,"name":"审批导入","url":"/product-import/approveProductImport","routerId":null,"addition":null,"parentId":14},{"id":21,"name":"项目管理","url":null,"routerId":null,"addition":"fa fa-calendar-check-o","parentId":0},{"id":22,"name":"项目新建与查询","url":null,"routerId":"project","addition":"fa fa-calendar-minus-o","parentId":21},{"id":23,"name":"项目预算管理","url":null,"routerId":"budget","addition":"fa fa-calendar-times-o","parentId":21},{"id":24,"name":"新建项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":25,"name":"修改项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":26,"name":"导出项目","url":"/project/exportProject","routerId":null,"addition":null,"parentId":22},{"id":27,"name":"查询项目","url":"/project/obtainProject","routerId":null,"addition":null,"parentId":22},{"id":28,"name":"删除预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":29,"name":"导入预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":30,"name":"查看预算","url":"/budget/obtainBudgets","routerId":null,"addition":null,"parentId":23},{"id":31,"name":"项目进度管理","url":null,"routerId":"progress","addition":"fa fa-list-ol","parentId":21},{"id":33,"name":"查看工程进度","url":"/construction-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":34,"name":"新建工程进度","url":"/construction-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":35,"name":"查看合同进度","url":"/contract-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":36,"name":"新建合同进度","url":"/contract-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":37,"name":"项目预算测算管理","url":null,"routerId":"calculate","addition":"fa fa-calculator","parentId":21},{"id":38,"name":"预算进项税计算","url":"/calculate/obtainCalculate","routerId":null,"addition":null,"parentId":37},{"id":39,"name":"预算税负计算","url":"/calculate/showTaxCalculate","routerId":null,"addition":null,"parentId":37},{"id":40,"name":"各部分采购","url":null,"routerId":null,"addition":"fa fa-shopping-cart","parentId":0},{"id":41,"name":"供应商管理","url":null,"routerId":"supplier","addition":"fa fa-address-book-o","parentId":40},{"id":42,"name":"新增供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":43,"name":"修改供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":44,"name":"采购成本税收测算","url":null,"routerId":"cost-tax","addition":"fa fa-asterisk","parentId":40},{"id":45,"name":"测算","url":null,"routerId":null,"addition":null,"parentId":44},{"id":46,"name":"实际实施采购管理","url":null,"routerId":"purchase","addition":"fa fa-shopping-cart","parentId":40},{"id":47,"name":"税务分析管理","url":null,"routerId":null,"addition":"fa fa-cogs","parentId":0},{"id":48,"name":"项目收款管理","url":null,"routerId":"receipt","addition":"fa fa-credit-card-alt","parentId":47},{"id":49,"name":"税收管理分析","url":null,"routerId":"tax-manager","addition":"fa fa-bookmark-o","parentId":47},{"id":50,"name":"纳税人身份管理","url":null,"routerId":"tax-man-manager","addition":"fa fa-address-book","parentId":47},{"id":51,"name":"税收分析与管理建议","url":null,"routerId":"advise","addition":"fa fa-envira","parentId":47}]}]}});
        httpBackend.when('POST','../dept/obtainDepts.cmd').respond({"data":[{"id":0,"name":"公司","parent":-1,"roles":[{"id":-2,"name":"管理员","mods":[{"id":1,"name":"系统配置","url":null,"routerId":null,"addition":"fa fa-user-secret","parentId":0},{"id":2,"name":"用户管理","url":null,"routerId":"user","addition":"fa fa-user","parentId":1},{"id":3,"name":"动态参数","url":null,"routerId":"conf","addition":"fa fa-pencil","parentId":1},{"id":4,"name":"新增用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":5,"name":"查看用户","url":"/user/obtainUsers","routerId":null,"addition":null,"parentId":2},{"id":6,"name":"删除用户","url":"/user/deleteUser","routerId":null,"addition":null,"parentId":2},{"id":7,"name":"修改用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":8,"name":"新增角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":9,"name":"查看角色","url":"/role/obtainRoles","routerId":null,"addition":null,"parentId":2},{"id":10,"name":"删除角色","url":"/role/deleteRole","routerId":null,"addition":null,"parentId":2},{"id":11,"name":"修改角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":12,"name":"查看部门","url":"/dept/obtainDepts","routerId":null,"addition":null,"parentId":2},{"id":13,"name":"商品管理","url":null,"routerId":null,"addition":"fa fa-truck","parentId":0},{"id":14,"name":"商品导入及审核","url":null,"routerId":"product","addition":"fa fa-truck","parentId":13},{"id":16,"name":"新增商品","url":"/product/saveProduct","routerId":null,"addition":null,"parentId":14},{"id":17,"name":"查看商品","url":"/product/obtainProducts","routerId":null,"addition":null,"parentId":14},{"id":18,"name":"删除商品","url":"/product/deleteProduct","routerId":null,"addition":null,"parentId":14},{"id":19,"name":"审批商品","url":"/product/approveProduct","routerId":null,"addition":null,"parentId":14},{"id":20,"name":"审批导入","url":"/product-import/approveProductImport","routerId":null,"addition":null,"parentId":14},{"id":21,"name":"项目管理","url":null,"routerId":null,"addition":"fa fa-calendar-check-o","parentId":0},{"id":22,"name":"项目新建与查询","url":null,"routerId":"project","addition":"fa fa-calendar-minus-o","parentId":21},{"id":23,"name":"项目预算管理","url":null,"routerId":"budget","addition":"fa fa-calendar-times-o","parentId":21},{"id":24,"name":"新建项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":25,"name":"修改项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":26,"name":"导出项目","url":"/project/exportProject","routerId":null,"addition":null,"parentId":22},{"id":27,"name":"查询项目","url":"/project/obtainProject","routerId":null,"addition":null,"parentId":22},{"id":28,"name":"删除预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":29,"name":"导入预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":30,"name":"查看预算","url":"/budget/obtainBudgets","routerId":null,"addition":null,"parentId":23},{"id":31,"name":"项目进度管理","url":null,"routerId":"progress","addition":"fa fa-list-ol","parentId":21},{"id":33,"name":"查看工程进度","url":"/construction-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":34,"name":"新建工程进度","url":"/construction-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":35,"name":"查看合同进度","url":"/contract-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":36,"name":"新建合同进度","url":"/contract-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":37,"name":"项目预算测算管理","url":null,"routerId":"calculate","addition":"fa fa-calculator","parentId":21},{"id":38,"name":"预算进项税计算","url":"/calculate/obtainCalculate","routerId":null,"addition":null,"parentId":37},{"id":39,"name":"预算税负计算","url":"/calculate/showTaxCalculate","routerId":null,"addition":null,"parentId":37},{"id":40,"name":"各部分采购","url":null,"routerId":null,"addition":"fa fa-shopping-cart","parentId":0},{"id":41,"name":"供应商管理","url":null,"routerId":"supplier","addition":"fa fa-address-book-o","parentId":40},{"id":42,"name":"新增供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":43,"name":"修改供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":44,"name":"采购成本税收测算","url":null,"routerId":"cost-tax","addition":"fa fa-asterisk","parentId":40},{"id":45,"name":"测算","url":null,"routerId":null,"addition":null,"parentId":44},{"id":46,"name":"实际实施采购管理","url":null,"routerId":"purchase","addition":"fa fa-shopping-cart","parentId":40},{"id":47,"name":"税务分析管理","url":null,"routerId":null,"addition":"fa fa-cogs","parentId":0},{"id":48,"name":"项目收款管理","url":null,"routerId":"receipt","addition":"fa fa-credit-card-alt","parentId":47},{"id":49,"name":"税收管理分析","url":null,"routerId":"tax-manager","addition":"fa fa-bookmark-o","parentId":47},{"id":50,"name":"纳税人身份管理","url":null,"routerId":"tax-man-manager","addition":"fa fa-address-book","parentId":47},{"id":51,"name":"税收分析与管理建议","url":null,"routerId":"advise","addition":"fa fa-envira","parentId":47}]},{"id":-1,"name":"副总经理","mods":[]},{"id":0,"name":"总经理","mods":[]}]},{"id":1,"name":"事业部","parent":0,"roles":[]},{"id":2,"name":"工程事业部","parent":1,"roles":[]},{"id":3,"name":"财务部","parent":2,"roles":[{"id":1,"name":"会计","mods":[]}]},{"id":4,"name":"合同预算部","parent":2,"roles":[{"id":2,"name":"预算员","mods":[]}]},{"id":5,"name":"材料供应部","parent":2,"roles":[{"id":3,"name":"材料员","mods":[]}]},{"id":6,"name":"市场经营部","parent":2,"roles":[{"id":4,"name":"操作员(4)","mods":[]}]},{"id":7,"name":"行政办公司","parent":2,"roles":[{"id":5,"name":"操作员(5)","mods":[]}]},{"id":8,"name":"机械设备部","parent":2,"roles":[{"id":6,"name":"操作员(6)","mods":[]}]},{"id":9,"name":"劳务管理部","parent":2,"roles":[{"id":7,"name":"操作员(7)","mods":[]}]},{"id":10,"name":"信息管理部","parent":2,"roles":[{"id":8,"name":"操作员(8)","mods":[]}]},{"id":11,"name":"安全环保部","parent":2,"roles":[{"id":9,"name":"操作员(9)","mods":[]}]},{"id":12,"name":"质量检查部","parent":2,"roles":[{"id":10,"name":"操作员(10)","mods":[]}]},{"id":13,"name":"法务清欠部","parent":2,"roles":[{"id":11,"name":"操作员(11)","mods":[]}]}],"total":14});
        httpBackend.when('POST', '../user/sessionUser.cmd').respond({data:{id:-10,name:"a",roles:[]}});
        httpBackend.when('POST', '../conf/obtainConfigs.cmd').respond({"data":[{"id":-10,"groupNo":0,"confName":"confirm.1","confValue":"是","confDesc":"通用确认"},{"id":-9,"groupNo":0,"confName":"confirm.2","confValue":"否","confDesc":"通用确认"},{"id":1,"groupNo":1,"confName":"nature.1","confValue":"库存材料","confDesc":"商品性质1"},{"id":2,"groupNo":1,"confName":"genre.1","confValue":"水泥","confDesc":"所属类型1"},{"id":3,"groupNo":1,"confName":"genre.2","confValue":"商品砼","confDesc":"所属类型2"},{"id":4,"groupNo":1,"confName":"genre.3","confValue":"钢材","confDesc":"所属类型3"},{"id":5,"groupNo":1,"confName":"genre.4","confValue":"砂石料","confDesc":"所属类型4"},{"id":6,"groupNo":1,"confName":"genre.5","confValue":"地砖类","confDesc":"所属类型5"},{"id":7,"groupNo":1,"confName":"genre.6","confValue":"管线类","confDesc":"所属类型6"},{"id":8,"groupNo":1,"confName":"genre.7","confValue":"化工产品","confDesc":"所属类型7"},{"id":9,"groupNo":1,"confName":"genre.8","confValue":"井盖类","confDesc":"所属类型8"},{"id":10,"groupNo":1,"confName":"genre.9","confValue":"门窗类","confDesc":"所属类型9"},{"id":11,"groupNo":1,"confName":"genre.10","confValue":"消防类","confDesc":"所属类型10"},{"id":12,"groupNo":1,"confName":"genre.11","confValue":"水暖配件","confDesc":"所属类型11"},{"id":13,"groupNo":1,"confName":"genre.12","confValue":"电工材料","confDesc":"所属类型12"},{"id":14,"groupNo":1,"confName":"genre.13","confValue":"五金工具","confDesc":"所属类型13"},{"id":15,"groupNo":1,"confName":"genre.14","confValue":"日杂类","confDesc":"所属类型14"},{"id":16,"groupNo":1,"confName":"genre.15","confValue":"周转材料","confDesc":"所属类型15"},{"id":17,"groupNo":1,"confName":"genre.16","confValue":"运费及其他费用","confDesc":"所属类型16"},{"id":18,"groupNo":1,"confName":"genre.17","confValue":"一批材料","confDesc":"所属类型17"},{"id":19,"groupNo":1,"confName":"genre.18","confValue":"实验仪器","confDesc":"所属类型18"},{"id":20,"groupNo":1,"confName":"genre.19","confValue":"木材类","confDesc":"所属类型19"},{"id":21,"groupNo":1,"confName":"genre.20","confValue":"沥青砼","confDesc":"所属类型20"},{"id":22,"groupNo":1,"confName":"genre.21","confValue":"小建材","confDesc":"所属类型21"},{"id":24,"groupNo":1,"confName":"weightUnit.1","confValue":"吨","confDesc":"重量单位"},{"id":25,"groupNo":1,"confName":"weightUnit.2","confValue":"千克","confDesc":"重量单位"},{"id":26,"groupNo":1,"confName":"bulkUnit.1","confValue":"立方米","confDesc":"体积单位"},{"id":27,"groupNo":1,"confName":"countUnit.1","confValue":"公斤","confDesc":"计量单位"},{"id":28,"groupNo":1,"confName":"countUnit.2","confValue":"千克","confDesc":"计量单位"},{"id":29,"groupNo":1,"confName":"countUnit.3","confValue":"袋","confDesc":"计量单位"},{"id":30,"groupNo":1,"confName":"countUnit.4","confValue":"立方厘米","confDesc":"计量单位"},{"id":31,"groupNo":1,"confName":"countUnit.5","confValue":"滥立方厘米","confDesc":"计量单位"},{"id":32,"groupNo":1,"confName":"countUnit.6","confValue":"立方分米","confDesc":"计量单位"},{"id":33,"groupNo":1,"confName":"countUnit.7","confValue":"批","confDesc":"计量单位"},{"id":34,"groupNo":1,"confName":"countUnit.8","confValue":"个","confDesc":"计量单位"},{"id":35,"groupNo":1,"confName":"countUnit.9","confValue":"付","confDesc":"计量单位"},{"id":36,"groupNo":1,"confName":"countUnit.10","confValue":"件","confDesc":"计量单位"},{"id":37,"groupNo":1,"confName":"countUnit.11","confValue":"克","confDesc":"计量单位"},{"id":38,"groupNo":1,"confName":"countUnit.12","confValue":"具","confDesc":"计量单位"},{"id":39,"groupNo":1,"confName":"countUnit.13","confValue":"副","confDesc":"计量单位"},{"id":40,"groupNo":1,"confName":"countUnit.14","confValue":"组","confDesc":"计量单位"},{"id":41,"groupNo":1,"confName":"countUnit.15","confValue":"平方分米","confDesc":"计量单位"},{"id":42,"groupNo":2,"confName":"projectType.1","confValue":"市政工程","confDesc":"项目类型"},{"id":43,"groupNo":2,"confName":"projectType.2","confValue":"公路工程","confDesc":"项目类型"},{"id":44,"groupNo":2,"confName":"projectType.3","confValue":"房屋建筑","confDesc":"项目类型"},{"id":45,"groupNo":2,"confName":"projectType.4","confValue":"水利工程","confDesc":"项目类型"},{"id":46,"groupNo":2,"confName":"projectType.5","confValue":"园林绿化","confDesc":"项目类型"},{"id":47,"groupNo":2,"confName":"projectType.6","confValue":"装修装饰","confDesc":"项目类型"},{"id":48,"groupNo":2,"confName":"projectType.7","confValue":"钢结构","confDesc":"项目类型"},{"id":49,"groupNo":2,"confName":"projectType.8","confValue":"其它","confDesc":"项目类型"},{"id":50,"groupNo":2,"confName":"rate.1","confValue":"11%","confDesc":"项目类型"},{"id":51,"groupNo":2,"confName":"rate.2","confValue":"3%","confDesc":"项目类型"},{"id":52,"groupNo":2,"confName":"projectMode.1","confValue":"总包","confDesc":"项目承接方式"},{"id":53,"groupNo":2,"confName":"projectMode.2","confValue":"分包","confDesc":"项目承接方式"},{"id":54,"groupNo":2,"confName":"supplyMode.1","confValue":"部分甲供材","confDesc":"项目承接方式"},{"id":55,"groupNo":2,"confName":"supplyMode.2","confValue":"清包工","confDesc":"项目承接方式"},{"id":56,"groupNo":2,"confName":"outSource.1","confValue":"是","confDesc":"项目是否对外外包"},{"id":57,"groupNo":2,"confName":"outSource.2","confValue":"否","confDesc":"项目是否对外外包"},{"id":60,"groupNo":2,"confName":"status.1","confValue":"正常","confDesc":"项目状态"},{"id":61,"groupNo":2,"confName":"status.2","confValue":"结束","confDesc":"是否为挂靠工程"},{"id":62,"groupNo":2,"confName":"status.3","confValue":"暂停","confDesc":"是否为挂靠工程"},{"id":63,"groupNo":2,"confName":"supply.1","confValue":"自行采购","confDesc":"分包项目施工用材料"},{"id":64,"groupNo":2,"confName":"supply.2","confValue":"总包方采购","confDesc":"分包项目施工用材料"},{"id":65,"groupNo":3,"confName":"identity.1","confValue":"A类供应商(一般纳税人)","confDesc":"供应商纳税人身份分类"},{"id":66,"groupNo":3,"confName":"identity.2","confValue":"B类供应商(小规模纳税人)","confDesc":"供应商纳税人身份分类"},{"id":67,"groupNo":3,"confName":"identity.3","confValue":"C类供应商(不能取得抵扣票据纳税人)","confDesc":"供应商纳税人身份分类"},{"id":68,"groupNo":1,"confName":"countUnit.16","confValue":"条","confDesc":"计量单位"},{"id":69,"groupNo":1,"confName":"countUnit.17","confValue":"盒","confDesc":"计量单位"}],"total":68});
        loginScope.login();
        httpBackend.flush();
        // 成功转到 user界面 
        expect(userState).toBe('user');

    });
});
